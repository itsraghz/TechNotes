# SpringBoot MicroServices - Session by Mr Raghu, Naresh IT

Session 88 \
14 Feb 2022 Mon \
7 00 AM IST - 08 00 AM IST

> New Classroom Link : https://classroom.google.com/u/0/c/NDA2NDE1MDg1MzAz

# Agenda

* SpringSecurity JWT Example

# Lecture Notes - downloaded from Google Classroom

* URL to the classroom notes : https://classroom.google.com/u/0/c/NDA2NDE1MDg1MzAz/m/NDY5NzIyMzYyMDgz/details

```
						Date : 14-02-2022
						Spring Boot 7AM
 						    Mr. RAGHU
-------------------------------------------------------------
```
JWT Security (task)
https://www.youtube.com/watch?v=feETfZbvu-k
https://www.youtube.com/watch?v=Hzkw846jIOU
https://www.youtube.com/watch?v=bJAsHOH4lMk

			Java JWT --- JJWT - Java JSON Web Token

Token is a unique number generated by server and stored at client
on authentication successful.

If next time is making Request to server it has to send token as a Header
 Parameter ex: Authorization= JWTToken.

server generates and validates token using one Secured Code (Secret).
If token is valid provide service, else not.

Token Format:
   XXXXXXXXXXXXXXXX.YYYYYYYYYYYYYYYYYY.ZZZZZZZZZZZZZZZ

Payload :
   id --- userId
   subject - username
   issuer  - Provider name
   issuedAt - date and time of generating token
   expDate  - How long token is valid
   sigWith  - Signature Alog. + Secret


Jwts(C) having builder() method to create token and parser() method to read
token (Claim the token).

Create and Parse are done using same secret.

---Maven Application------------------
1. pom.xml
	<properties>
		<maven.compiler.source>1.8</maven.compiler.source>
		<maven.compiler.target>1.8</maven.compiler.target>
	</properties>
	<dependencies>
		<dependency>
			<groupId>io.jsonwebtoken</groupId>
			<artifactId>jjwt</artifactId>
			<version>0.9.1</version>
		</dependency>
		<dependency>
			<groupId>javax.xml.bind</groupId>
			<artifactId>jaxb-api</artifactId>
			<version>2.3.0</version>
		</dependency>

	</dependencies>

2. Test class
package in.nit.raghu;

import java.util.Date;
import java.util.concurrent.TimeUnit;

import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;

public class TestClass {

	public static void main(String[] args) {
		String secret = "NITRaghu";

		String token =
				Jwts.builder()
				.setId("123456") //userId (optional)
				.setSubject("ajaykumar") //username
				.setIssuer("NareshIT") //provider name
				.setIssuedAt(new Date())
				.setExpiration(new Date(System.currentTimeMillis() + TimeUnit.MINUTES.toMillis(5)))
				.signWith(SignatureAlgorithm.HS256, secret.getBytes())
				.compact();

		System.out.println(token);

		//Claims -- Read Token data
		Claims cob =
		Jwts.parser()
		.setSigningKey(secret.getBytes())
		.parseClaimsJws(token)
		.getBody();

		System.out.println(cob.getId());
		System.out.println(cob.getSubject());
		System.out.println(cob.getIssuer());
		System.out.println(cob.getIssuedAt());
		System.out.println(cob.getExpiration());
	}
}
==================================================================
1. Registe using JSON Data
{
 "username":
 "password":
 "email"   :
 "roles"   :

}

@RequestBody --> JSON ---> object --> repo.save(obj)

2. Login using JSON
{
  "username":
   "password":
}

@RequestBody --> JSON ---> object --> Check in DB using AuthenticationManager

If valid --> JWT Token Generated

3. Access any Resource using JWT

Header :
 Authorization = JWT Token along with Request URL

Full Code Link: https://github.com/javabyraghu/SpringBoot2SecurityJwtAp

How to Import after Download into STS/Eclipse
> Right click at Package Explorer > Import > Maven Project
> Select Existed Maven Project > Enter POM.xml location of Project
> Next > Finish

=======================================================================
1. JwtUtil
>> generateToken(subject)
>> validateToken *check username exist or not?

2. Filter
  >> Define a Security Filter that extends OncePerRequestFilter
    and override doFilterInternal()
    which gets executed for every request.

    if Request is permitAll---> Directly access, else ask for Token
    else check token, if valid, read user, create UsernamePasswordAuthenticationToken
    and set it to request and inside SecurityContext object.

3. Security Config
  >> create AuthenticationManager object manullay
  >> Disable CSRF Token [ csrf().disable() ]
  >> Convert into Stateless : SessionCreationPolicy.STATELESS
  >> Link Filter before to Spring Security Default one
    addFilterBefore(securityFilter,____)

  >> Use BCryptPasswordEncoder to encode password


4. Rest Controller
  >> save data : JSON --> @RequestBody --> user -> Store in DB
  >> login : JSON --> @RequestBody -> Check exist in DB or not?
  		-> if exist create token, else 401 UN AUTHORIZED

  >> any one method (with authentication)
   pass Header
